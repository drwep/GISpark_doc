

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Shapely-几何对象操作的Python库 &mdash; GISpark 0.1 文档</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="GISpark 0.1 文档" href="../index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> GISpark
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../gispark_prefix.html">前言</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gispark_profile.html">1. GISpark简介</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gispark_cloud.html">2. 云计算基础设施</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gispark_paas.html">3. 分布式计算与持续交付</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gispark_saas.html">4. 地理空间信息服务平台</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gispark_process.html">5. 地理空间信息数据处理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gispark_mapping.html">6. 地理制图与空间可视化</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gispark_analyst.html">7. 高级空间分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gispark_network.html">8. 地理空间网络</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gispark_stream.html">9. 实时流处理</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gispark_dimension.html">10. 多维时空分析</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gispark_ml.html">11. 机器学习框架</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gispark_science.html">12. 模型构建与共享</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gispark_appendix.html">附录</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">GISpark</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Shapely-几何对象操作的Python库</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/geospatial/shapely.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput > div,
div.nbinput div[class^=highlight],
div.nbinput div[class^=highlight] pre,
div.nboutput,
div.nboutput > div,
div.nboutput div[class^=highlight],
div.nboutput div[class^=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class^=highlight] pre {
    line-height: unset;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput > :first-child pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput > :first-child pre {
    color: #D84315;
}

/* all prompts */
div.nbinput > :first-child[class^=highlight],
div.nboutput > :first-child[class^=highlight],
div.nboutput > :first-child {
    min-width: 11ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}

/* input/output area */
div.nbinput > :nth-child(2)[class^=highlight],
div.nboutput > :nth-child(2),
div.nboutput > :nth-child(2)[class^=highlight] {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
}

/* input area */
div.nbinput > :nth-child(2)[class^=highlight] {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput  > :nth-child(2).stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }
</style>
<div class="section" id="Shapely-几何对象操作的Python库">
<h1>Shapely-几何对象操作的Python库<a class="headerlink" href="#Shapely-几何对象操作的Python库" title="永久链接至标题">¶</a></h1>
<p>Shapely提供地理几何对象数据结构、编解码及对象之间的几何代数运算，支持WKT和JSON的几何对象编解码。<a class="reference external" href="http://pypi.python.org/pypi/Shapely/#downloads">Downloads</a></p>
<p>Shapely是基于笛卡尔坐标系进行几何对象的操作和几何分析Python库，使用BSD许可。
It is based on the widely deployed GEOS (the engine of PostGIS) and JTS
(from which GEOS is ported) libraries. Shapely is not concerned with
data formats or coordinate systems, but can be readily integrated with
packages that are. For more details, see:</p>
<p><a class="reference external" href="https://github.com/Toblerity/Shapely.git">Shapely on GitHub</a></p>
<p><a class="reference external" href="http://toblerity.github.com/shapely/manual.html">Shapely manual</a></p>
<div class="section" id="安装Shapely">
<h2>安装Shapely<a class="headerlink" href="#安装Shapely" title="永久链接至标题">¶</a></h2>
<p>Shapely 1.5.x 要求：</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">Python</span> <span class="o">&gt;=</span><span class="mf">2.6</span> <span class="p">(</span><span class="n">including</span> <span class="n">Python</span> <span class="mf">3.</span><span class="n">x</span><span class="p">)</span>

<span class="n">GEOS</span> <span class="o">&gt;=</span><span class="mf">3.3</span> <span class="p">(</span><span class="n">Shapely</span> <span class="mf">1.2</span><span class="o">.</span><span class="n">x</span> <span class="n">requires</span> <span class="n">only</span> <span class="n">GEOS</span> <span class="mf">3.1</span> <span class="n">but</span> <span class="n">YMMV</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li>安装Shapely：</li>
</ul>
<p>Windows用户直接下载可执行文件安装：
<a class="reference external" href="http://www.lfd.uci.edu/~gohlke/pythonlibs/#shapely">http://www.lfd.uci.edu/~gohlke/pythonlibs/#shapely</a> 。</p>
<p>其它系统, 需要先安装GEOS (在OS X上运行<code class="docutils literal"><span class="pre">brew</span> <span class="pre">install</span> <span class="pre">geos</span></code>
或在Debian/Ubuntu上 <code class="docutils literal"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">libgeos-dev</span></code>),
然后运行下面的命令安装Shapely。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ pip install shapely
</pre></div>
</div>
<p>如果已经安装GEOS到非缺省的目录位置, <code class="docutils literal"><span class="pre">geos-config</span></code>
程序可以获得编译器和连接器的选项信息。如果没有在PATH中设置，可以通过<code class="docutils literal"><span class="pre">GEOS_CONFIG</span></code>
环境变量进行设置：</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ GEOS_CONFIG=/path/to/geos-config
pip install shapely
</pre></div>
</div>
<p>如果系统中GEOS版本&lt; 3.3.0，将不能使用Shapely
1.3以上版本，请使用下面的方法安装较低的版本。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ pip install shapely&lt;1.3
</pre></div>
</div>
<p>如果使用pip 6+，使用以下方法安装：</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ pip install shapely~=1.2
</pre></div>
</div>
<p>Shapely 提供流行的Python分发版的安装，如Canopy (Enthought) 和 Anaconda
(Continuum Analytics)。</p>
</div>
<div class="section" id="Shapely用法">
<h2>Shapely用法<a class="headerlink" href="#Shapely用法" title="永久链接至标题">¶</a></h2>
<p>创建一个点对象，然后做缓冲区，形成一个圆，并计算圆的面积：</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">patch</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">patch</span>
<span class="go">&lt;shapely.geometry.polygon.Polygon object at 0x...&gt;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">patch</span><span class="o">.</span><span class="n">area</span>
<span class="go">313.65484905459385</span>
</pre></div>
</div>
<p>更多的例子和用法，参考
<a class="reference external" href="http://toblerity.github.com/shapely/manual.html">Shapely使用手册</a> 和
<a class="reference external" href="https://github.com/sgillies/shapely/tree/master/shapely/examples">Shapely
examples</a>。</p>
</div>
<div class="section" id="Shapely集成">
<h2>Shapely集成<a class="headerlink" href="#Shapely集成" title="永久链接至标题">¶</a></h2>
<p>Shapely不提供文件读写接口,
但可以序列化和反序列化，支持一些常用的格式和协议。</p>
<ul class="simple">
<li>WKT/WKB</li>
</ul>
<p>提供shapely.wkb和shapely.wkt支持数据的载入和保存。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">shapely.wkt</span> <span class="kn">import</span> <span class="n">dumps</span><span class="p">,</span> <span class="n">loads</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">dumps</span><span class="p">(</span><span class="n">loads</span><span class="p">(</span><span class="s1">&#39;POINT (0 0)&#39;</span><span class="p">))</span>
<span class="go">&#39;POINT (0.0000000000000000 0.0000000000000000)&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li>Numpy array</li>
</ul>
<p>所有的linear objects, 如polygon 的rings (类似上面的 patch )， 提供 Numpy
array 访问接口：</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">asarray</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ag</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">patch</span><span class="o">.</span><span class="n">exterior</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ag</span>
<span class="go">array([[  1.00000000e+01,   0.00000000e+00],</span>
<span class="go">       [  9.95184727e+00,  -9.80171403e-01],</span>
<span class="go">       [  9.80785280e+00,  -1.95090322e+00],</span>
<span class="go">       ...</span>
<span class="go">       [  1.00000000e+01,   0.00000000e+00]])</span>
</pre></div>
</div>
<p>Numpy arrays 可以采用为 Shapely 的 linestrings 对象:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">asLineString</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">asLineString</span><span class="p">(</span><span class="n">ag</span><span class="p">)</span><span class="o">.</span><span class="n">length</span>
<span class="go">62.806623139095073</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">asLineString</span><span class="p">(</span><span class="n">ag</span><span class="p">)</span><span class="o">.</span><span class="n">wkt</span>
<span class="go">&#39;LINESTRING (10.0000000000000000 0.0000000000000000, ...)&#39;</span>
</pre></div>
</div>
<ul class="simple">
<li>X,Y</li>
</ul>
<p>形成 Numpy array，结构为[x, y] 的 arrays对象。但这不是与 Matplotlib
准确配合的绘制对象，因此在Shapely 1.2添加了 xy 属性，分别获得x和y的值：</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">patch</span><span class="o">.</span><span class="n">exterior</span><span class="o">.</span><span class="n">xy</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ax</span>
<span class="go">array([  1.00000000e+01,   9.95184727e+00,   9.80785280e+00,  ...])</span>
</pre></div>
</div>
<ul class="simple">
<li>GeoJSON</li>
</ul>
<p>Shapely可以和其它的Python GIS软件包使用类似GeoJSON的数据结构。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">mapping</span><span class="p">,</span> <span class="n">shape</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="s1">&#39;{&quot;type&quot;: &quot;Point&quot;, &quot;coordinates&quot;: [0.0, 0.0]}&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span>
<span class="go">&lt;shapely.geometry.point.Point object at 0x...</span>

<span class="go">&gt;&gt;&gt;&gt; print(json.dumps(mapping(s)))</span>
<span class="go">{&quot;type&quot;: &quot;Point&quot;, &quot;coordinates&quot;: [0.0, 0.0]}</span>
</pre></div>
</div>
</div>
<div class="section" id="开发与测试">
<h2>开发与测试<a class="headerlink" href="#开发与测试" title="永久链接至标题">¶</a></h2>
<p>开发Shapely的依赖文件列在requirements-dev.txt中。Cython 和 Numpy
在运行时不需要，但在开发时需要。强烈建议使用virtual
environment进行开发和测试（如下所示），也可以使用Anaconda的Conda创建和使用虚拟环境。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>$ virtualenv .
$ source bin/activate(env)
$ pip install -r requirements-dev.txt(env)
$ pip install -e .
</pre></div>
</div>
<p>使用 py.test 去运行 Shapely’s 里面的 unittests 和 doctests。</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>(env)$ py.test tests
</pre></div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; 版权所有 2016, http://www.supermap.com,http://www.supermap.com.cn.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="../_static/translations.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>